#FROM rust:latest
#FROM rust:1.36.0 AS build
FROM clux/muslrust AS build

ARG nodeType

RUN mkdir /environment/

COPY . /environment/

WORKDIR /environment/

RUN rustup target add x86_64-unknown-linux-musl

RUN cargo build --release

# Copy the source and build the application.
COPY ./src ./src

####
#RUN apt-get install pkg-config libx11-dev libxmu-dev

RUN cargo install --target x86_64-unknown-linux-musl --path .

################second stage
FROM scratch

EXPOSE 8081

#test
#COPY --from=build /usr/local/cargo/bin/core .

#works
###COPY --from=build /environment/target/x86_64-unknown-linux-musl/release/core .

###COPY --from=build /environment/storage ./storage

###CMD ["./core node-name=\"alices node\" node-id=1 port=8081 peers=127.0.0.1:8082,127.0.0.1:8083 ip=127.0.0.1:8081"]
